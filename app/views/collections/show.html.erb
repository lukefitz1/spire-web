<p id="notice"><%= notice %></p>

<% content_for :title, "Show Collection" %>

<p>
  <strong>Collectionname:</strong>
  <%= @collection.collectionName %>
</p>

<p>
  <strong>Identifier:</strong>
  <%= @collection.identifier %>
</p>

<p>
  <strong>Year:</strong>
  <%= @collection.year %>
</p>

<p>
  <strong>Customer:</strong>
  <% unless @collection.customer.blank? %>
    <%= @collection.customer.firstName %><%= ' ' %><%= @collection.customer.lastName %>
  <% end %>
</p>

<p>
  <strong>Proposals:</strong>
  <% @collection.customer_proposals.each do |pdf| %>
    <%= pdf %>
  <% end %>
</p>

<p>
  <strong>Invoices:</strong>
  <% @collection.customer_invoices.each do |pdf| %>
    <%= pdf %>
  <% end %>
</p>

<p>
  <strong>Additional Photos:</strong>
  <% @collection.additional_photos.each do |img| %>
    <%= image_tag img.thumb.url %>
  <% end %>
</p>

<% if @collection.customer %>
  <%= link_to 'New Artwork', new_from_collection_path(:coll_id => @collection.id, :cust_id => @collection.customer.id, :collection_redirect => true) %><br /><br />
<% else %>
  <%= link_to 'New Artwork', new_from_collection_path(:coll_id => @collection.id, :collection_redirect => true) %><br /><br />
<% end %>

<% unless @collection.artworks.blank? %>

  <!-- Artworks Table -->
  <table>
    <thead>
      <tr>
        <th>Object ID</th>
        <th>Art Type</th>
        <th>Title</th>
        <th>Artist</th>
        <th>Date</th>
        <th>Medium</th>
        <th>Image</th>
        <th>Dimensions</th>
        <th>Frame Dimensions</th>
        <th>Current Location</th>
        <th>Source</th>
        <th>Date Acquired</th>
        <th>Notes</th>
        <th>Amount Paid</th>
        <th>Current Value</th>
        <th>Notes Image</th>
        <th>Additional Info Image</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @collection.artworks.each do |artwork| %>
        <tr>
          <td><%= artwork.ojbId %></td>
          <td><%= artwork.artType %></td>
          <td><%= artwork.title %></td>

          <td>
            <% unless artwork.artist.blank? %>
              <%= artwork.artist.firstName %><%= ' ' %><%= artwork.artist.lastName %>
            <% end %> 
          </td>

          <td><%= artwork.date %></td>
          <td><%= artwork.medium %></td>

          <td>
            <% if artwork.image.thumb.url %>
              <%= image_tag artwork.image.thumb.url %>
            <% end %>
          </td>

          <td><%= artwork.dimensions %></td>
          <td><%= artwork.frame_dimensions %></td>
          <td><%= artwork.currentLocation %></td>
          <td><%= artwork.source %></td>
          <td><%= artwork.dateAcquired %></td>
          <td><%= artwork.notes %></td>
          <td><%= artwork.amountPaid %></td>
          <td><%= artwork.currentValue %></td>

          <td>
            <% if artwork.notesImage.thumb.url %>
              <%= image_tag artwork.notesImage.thumb.url %>
            <% end %>
          </td>

          <td>
            <% if artwork.additionalInfoImage.thumb.url %>
              <%= image_tag artwork.additionalInfoImage.thumb.url %>
            <% end %>
          </td>

          <td><%= link_to 'Edit', edit_artwork_path(artwork, :coll_id => @collection.id, :collection_redirect => true) %></td>
          <td><%= link_to 'HTML Preview', preview_html_path(artwork) %></td>
          <td><%= link_to 'PDF', preview_pdf_path(artwork, format: :pdf) %></td>
          <td><%= link_to 'Combined_PDF', fancy_report_path(artwork, format: :pdf) %></td>

        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<%= link_to 'New Visit', new_visit_from_collection_path(:coll_id => @collection.id, :collection_redirect => true) %><br /><br />

<% unless @collection.visits.blank? %>
  <table>
    <thead>
      <tr>
        <th>Visit notes</th>
        <th>Visit date start</th>
        <th>Visit date end</th>
        <th colspan="2"></th>
      </tr>
    </thead>

    <tbody>
      <% @collection.visits.each do |visit| %>
        <tr>
          <td><%= visit.visit_notes %></td>
          <td><%= visit.visit_date_start %></td>
          <td><%= visit.visit_date_end %></td>
          <td><%= link_to 'Edit', edit_visit_path(visit, :coll_id => @collection.id, :collection_redirect => true) %></td>
          <td><%= link_to 'Delete', visit_path(:id => visit.id, :coll_id => @collection.id, :collection_redirect => true), method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<h4>Import that data!</h4>
  <%= form_tag import_path, multipart: true do %>
    <%= file_field_tag :file, :required => true %>
    
    <% unless @collection.customer.blank? %>
      <%= hidden_field_tag(:customer_id, @collection.customer.id) %>
    <% end %>

    <%= hidden_field_tag(:collection_id, @collection.id) %>
    <%= hidden_field_tag(:collection_flag, true) %>
    <%= submit_tag "Import Artwork" %>
<% end %>

<% if @collection.customer %>
  <%= link_to 'Edit', edit_collection_path(@collection, :cust_id => @collection.customer.id) %> |
<% else %>
  <%= link_to 'Edit', edit_collection_path(@collection) %> |
<% end %>

<%= link_to 'Back', collections_path %>

<script>
  // self executing function here
  (function() {
    bio = document.getElementById('artist-bio');
    if (bio.textContent.length < 1325) {
      bio.style.fontSize = '16px';
    } else {
      bio.style.fontSize = '15px';
    }
  })();
</script>